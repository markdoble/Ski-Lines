(function(){window.nested_form_fields||(window.nested_form_fields={}),nested_form_fields.bind_nested_forms_links=function(){return $("body").off("click",".add_nested_fields_link"),$("body").on("click",".add_nested_fields_link",function(e,t){var d,i,n,s,_,a,l,o,r,f;return i=$(this),o=i.data("object-class"),a=i.data("association-path"),_=$(".nested_"+a).length,$.event.trigger("fields_adding.nested_form_fields",{object_class:o,added_index:_,association_path:a,additional_data:t}),s=i.data("scope")?$(i.data("scope")+" #"+a+"_template"):$("#"+a+"_template"),r=i.data("insert-into"),f=s.html(),l="__"+a+"_index__",f=f.replace(new RegExp(l,"g"),_),f=f.replace(new RegExp("__nested_field_for_replace_with_index__","g"),_),n=$(f),d=n.closestChild(".form_template"),d.each(function(){var e;return e=$(this),e.replaceWith($("<script id='"+e.attr("id")+"' type='text/html' />").html(e.html()))}),null!=r?$("#"+r).append(n):s.before(n),n.trigger("fields_added.nested_form_fields",{object_class:o,added_index:_,association_path:a,event:e,additional_data:t}),!1}),$("body").off("click",".remove_nested_fields_link"),$("body").on("click",".remove_nested_fields_link",function(){var e,t,d,i,n,s;return e=$(this),$.rails.allowAction(e)?(n=e.data("object-class"),d=e.data("delete-association-field-name"),s=parseInt(d.match("(\\d+\\]\\[_destroy])")[0].match("\\d+")[0]),$.event.trigger("fields_removing.nested_form_fields",{object_class:n,delete_association_field_name:d,removed_index:s}),t=e.parents(".nested_fields").first(),i=t.find("input[type='hidden'][name='"+d+"']"),i.length>0?i.val("1"):t.before("<input type='hidden' name='"+d+"' value='1' />"),t.hide(),t.find("input[required]:hidden").removeAttr("required"),t.trigger("fields_removed.nested_form_fields",{object_class:n,delete_association_field_name:d,removed_index:s}),!1):!1})},$(document).on("page:change turbolinks:load",function(){return nested_form_fields.bind_nested_forms_links()}),jQuery(function(){return nested_form_fields.bind_nested_forms_links()}),$.fn.closestChild=function(e){var t,d;return t=void 0,d=void 0,t=this.children(),0===t.length?$():(d=t.filter(e),d.length>0?d:t.closestChild(e))}}).call(this);